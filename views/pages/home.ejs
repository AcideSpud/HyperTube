<% include header2 %>

	<p> bienvenue <%= user %> </p>


		<main class="wrapper">

		

		<div class="container">
			<div class="search">
		        <div class="container-fluid">
		          <div class="row">
		            <div class="col-md-12">
		              <div class="form-section">
		                <div class="row">

		                      <div class="col-md-12">
		                        <div class="form-group">
		                          <label class="sr-only" for="filmSearch">filmSearch
		                          </label>
		                          <input type="text" class="form-control" id="filmSearch" placeholder="Rechercher...">
		                        </div>
		                      </div>

		                      <div class="col-md-3">
		                        <div class="form-group">
		                          <label class="sr-only" for="title">Tri par titre</label>
		                          <div class="input-group">
		                            <input type="text" class="form-control" id="title" placeholder="Tri par titre">
		                            <span id="title-asc" class="input-group-addon"><i class="glyphicon glyphicon-chevron-up"></i></span>
		                          </div>
		                        </div>
		                        <!-- <div class="link">Tri par titre<i class="fa fa-chevron-up"></i></div> -->
		                      </div>
		                      <div class="col-md-3">
		                        <div class="form-group">
		                          <label class="sr-only" for="year">Tri par année</label>
		                          <div class="input-group">
		                            <input type="text" class="form-control" id="year" placeholder="Tri par année">
		                            <span id="year-asc" class="input-group-addon"><i class="glyphicon glyphicon-chevron-up"></i></span>
		                          </div>
		                        </div>
		                      </div>
		                      <div class="col-md-3">
		                        <div class="form-group">
		                          <label class="sr-only" for="rank">Tri par note IMDb</label>
		                          <div class="input-group">
		                            <input type="text" class="form-control" id="rank" placeholder="Tri par note IMDb">
		                            <span id="rank-asc" class="input-group-addon"><i class="glyphicon glyphicon-chevron-up"></i></span>
		                          </div>
		                        </div>
		                      </div>
		                      <div class="col-md-3">
		                        <div class="form-group">
		                          <label class="sr-only" for="length">Tri par durée</label>
		                          <div class="input-group">
		                            <input type="text" class="form-control" id="length" placeholder="Tri par durée">
		                            <span id="length-asc" class="input-group-addon"><i class="glyphicon glyphicon-chevron-up"></i></span>
		                          </div>
		                        </div>
		                      </div>
		                      <div class="col-md-3">
		                        <div class="form-group">
		                          <label class="sr-only" for="genre">Genre</label>
		                          <select id="genre" name="genre" class="form-control" required="">
									<option disabled="" selected="">Genre</option>		                      				
									<option value="1">Genre1</option>
									<option value="2">Genre2</option>
									<option value="3">Genre3</option>
									<option value="4">Genre4</option>
									<option value="5">Genre5</option>
									<option value="6">Genre6</option>
									<option value="7">Genre7</option>
									<option value="8">Genre8</option>
									<option value="9">Genre9</option>
									<option value="10">Genre10</option>
									<option value="11">Genre11</option>
									<option value="12">Genre12</option>
									<option value="13">Genre13</option>
									<option value="14">Genre14</option>
									<option value="15">Genre15</option>
									<option value="16">Genre16</option>
		                          </select>
		                        </div>
		                      </div>
		                      <div class="col-md-3">
		                        <div class="form-group">
		                          <label class="sr-only" for="genre">Année de production</label>
		                          <select id="genre" name="genre" class="form-control" required="">
									<option disabled="" selected="">Année de production</option>		                      				
									<option value="<1930">Avant 1930</option>
									<option value="1930">Années 1930</option>
									<option value="1940">Années 1940</option>
									<option value="1950">Années 1950</option>
									<option value="1960">Années 1960</option>
									<option value="1970">Années 1970</option>
									<option value="1980">Années 1980</option>
									<option value="1990">Années 1990</option>
									<option value="2000">Années 2000</option>
									<option value="2010">Années 2010</option>
		                          </select>
		                        </div>
		                      </div>
		                      <div class="col-md-3">
		                        <div class="form-group">
		                          <label class="sr-only" for="genre">Note IMDb</label>
		                          <select id="genre" name="genre" class="form-control" required="">
									<option disabled="" selected="">Note IMDb</option>		                      				
									<option value="0">0</option>
									<option value="1">1</option>
									<option value="2">2</option>
									<option value="3">3</option>
									<option value="4">4</option>
									<option value="5">5</option>
									<option value="6">6</option>
									<option value="7">7</option>
									<option value="8">8</option>
									<option value="9">9</option>
									<option value="10">10</option>
		                          </select>
		                        </div>
		                      </div>
		                      <div class="col-md-3">
		                        <div class="form-group">
		                          <label class="sr-only" for="genre">Titres commençant par:</label>
		                          <select id="genre" name="genre" class="form-control" required="">
									<option disabled="" selected="">Titres commençant par:</option>		                      				
									<option value="a">A</option>
									<option value="b">B</option>
									<option value="c">C</option>
									<option value="d">D</option>
									<option value="e">E</option>
									<option value="f">F</option>
									<option value="g">G</option>
									<option value="h">H</option>
									<option value="i">I</option>
									<option value="j">J</option>
									<option value="k">K</option>
									<option value="l">L</option>
									<option value="m">M</option>
									<option value="n">N</option>
									<option value="o">O</option>
									<option value="p">P</option>
									<option value="q">Q</option>
									<option value="r">R</option>
									<option value="s">S</option>
									<option value="t">T</option>
									<option value="u">U</option>
									<option value="v">V</option>
									<option value="w">W</option>
									<option value="x">X</option>
									<option value="y">Y</option>
									<option value="z">Z</option>
									<option value="autre">Autre</option>
		                          </select>
		                        </div>
		                      </div>
		                </div>
		              </div>
		            </div>
		          </div>
		         </div>
	        </div>



			<div class="container" id="loadAnim">
				<div class="row">
		            <div id="loading">
		                <ul class="bokeh">
		                    <li></li>
		                    <li></li>
		                    <li></li>
		                    <li></li>
		                    <li></li>
		                </ul>
		            </div>
				</div>
			</div>

			<div id="filmsList">
				<div class="col-md-3" id="model">
					<div class="film">
						<div class="image-container">
						</div>
						<div class="filmInfo">
							<div class="text">
								<div class="title"></div>
								<!-- <button type="submit" id="browseFilm" class="btn btn-info"><i class="fa fa-play"></button> -->
								<a id="browseFilm" type="button" class="btn-o"><i class="fa fa-play-circle fa-5x"></i></a>
								<div class="year"></div>
								<div class="rating"></div>
								<div class="summary"></div>
							</div>
						</div>
					</div>
				</div>
			</div>

			
		</div>			
		</main>


		<script type="text/javascript">

				var socket = io.connect('http://localhost:8080');
		    	socket.on('connect', function() {

		    		var id = 0;

			        socket.emit('getFilmsList', {id: socket.id});
			        $('#loadAnim').css("display", "block");

			        socket.on('browseFilmsList', function(data){
			        	console.log(data.filmsList.title)
			        	$('#loadAnim').css("display", "none");
						var filmsList = data.filmsList;
						if (filmsList.movieDatas) {
							var poster = filmsList.movieDatas.poster;
							if ((poster.slice(0, 4) == "http")) {
									var clone = $("#model").clone();
									clone.css("display", "block");
									clone.attr("id", id++);
									clone.css("margin-bottom", "10px");
									clone.hover(function() {
										$(this).find('.filmInfo').css("display", "inline-block");
									    }, function(){
									    $(this).find('.filmInfo').css("display", "none");
									});
									clone.find('.image-container').css('backgroundImage', 'url("'+filmsList.movieDatas.poster+'")');
									clone.find('.image-container').css('background-repeat', 'round');
									clone.find('.title').text(filmsList.movieDatas.title);
									clone.find('.year').text("Année de production: "+filmsList.movieDatas.year);
									clone.find('.rating').text("Note IMDb: "+filmsList.movieDatas.rating);
									clone.find('.summary').text("Résumé: "+filmsList.movieDatas.plot);
									clone.hide().fadeIn()
									$('#filmsList').append(clone);
							}
						}
						// Système de pagination par scroll infini
						$(document).ready(function() {
							var win = $(window);
							win.data('ajaxready', true);

							// Each time the user scrolls
							win.scroll(function() {
								if (win.data('ajaxready') == false) return;
								// End of the document reached?
								if ($(document).height() - win.height() == win.scrollTop()) {
									//Empeche de boucler sur l'évênement
									win.data('ajaxready', false);
									socket.emit('getMoreFilms', {id: socket.id});									
								}
							});
						});
					});


					$("#filmSearch").on('keyup', function (e) {
				        if (e.keyCode == 13) {
							var clone = $("#model").clone();
				            $('#filmsList').html('');
				            $('#filmsList').append(clone);
			        		$('#loadAnim').css("display", "block");
				            socket.emit('getFilmsList', {id: socket.id, title: $("#filmSearch").val()});
				        }
				    });
	
					
						
					$('.input-group-addon').on('click', (e) => {
						console.log(e.currentTarget.id)
				    	socket.emit('getDatSort', {id: socket.id, sort: e.currentTarget.id});
						var clone = $("#model").clone();
			            $('#filmsList').html('');
			            $('#filmsList').append(clone);
		        		$('#loadAnim').css("display", "block");
				    	var tab = e.currentTarget.id.split('-')
				    	if (tab[1] == 'asc') {
				    		tab[1] = 'desc'
				    	}
				    	else {
				    		tab[1] = 'asc'
				    	}
				    	setTimeout(() => {
				    		$('#'+e.currentTarget.id).attr('id', tab.join('-'))
				    	}, 1000)
					})

		    	});
		</script>

<%include footer %>